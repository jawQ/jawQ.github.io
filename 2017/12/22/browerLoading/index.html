<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Brower-Loading-Principle"><meta name="keywords" content=""><meta name="author" content="JawQ_,undefined"><meta name="copyright" content="JawQ_"><title>Brower-Loading-Principle | JawQ_</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.4.3"><script>var GLOBAL = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  localSearch: undefined
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#先大概了解浏览器加载历程下："><span class="toc-number">1.</span> <span class="toc-text">先大概了解浏览器加载历程下：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跟着目录来："><span class="toc-number">2.</span> <span class="toc-text">跟着目录来：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#渲染流水线："><span class="toc-number">2.1.</span> <span class="toc-text">渲染流水线：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#浏览器渲染机制-图："><span class="toc-number">2.2.</span> <span class="toc-text">浏览器渲染机制 - 图：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#细节流程："><span class="toc-number">2.2.1.</span> <span class="toc-text">细节流程：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOM-Tree-是什么"><span class="toc-number">2.2.2.</span> <span class="toc-text">DOM-Tree 是什么?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOM-Tree-结构-解析："><span class="toc-number">2.2.3.</span> <span class="toc-text">DOM-Tree 结构 - 解析：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOM-Tree-结构的-构建："><span class="toc-number">2.2.4.</span> <span class="toc-text">DOM-Tree 结构的 - 构建：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#那这个CSS-tree是什么呢？"><span class="toc-number">2.2.5.</span> <span class="toc-text">那这个CSS-tree是什么呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#为什么会有CSS-tree？"><span class="toc-number">2.2.6.</span> <span class="toc-text">为什么会有CSS-tree？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSS-tree的构建："><span class="toc-number">2.2.7.</span> <span class="toc-text">CSS-tree的构建：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Render树又是啥？"><span class="toc-number">2.2.8.</span> <span class="toc-text">Render树又是啥？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解析CSS-选择器的顺序："><span class="toc-number">2.2.9.</span> <span class="toc-text">解析CSS-选择器的顺序：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#性能优化注意点："><span class="toc-number">2.3.</span> <span class="toc-text">性能优化注意点：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#会阻塞DOM树的构建的因素："><span class="toc-number">2.3.1.</span> <span class="toc-text">会阻塞DOM树的构建的因素：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#会导致reflow、repaint的因素："><span class="toc-number">2.3.2.</span> <span class="toc-text">会导致reflow、repaint的因素：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">2.4.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/JawQ.png"></div><div class="author-info__name text-center">JawQ_</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">7</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">14</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">关于JawQ：</div><a class="author-info-links__name text-center" href="https://juejin.im/user/58b39f0e2f301e00680d71f0" target="_blank">掘金</a><a class="author-info-links__name text-center" href="https://www.zhihu.com/people/JawQ/activities" target="_blank">知乎</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://drscdn.500px.org/photo/241217445/q%3D80_m%3D2000_k%3D1/v2?webp=true&amp;sig=20a0a057e571acfe0fd27f642b6908c963c15ddb841447bd91d890b5647eacb1)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">JawQ_</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/Tags">Tags</a></span></div><div id="post-info"><div id="post-title">Brower-Loading-Principle</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-03-22</time><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2,181</span><span class="post-meta__separator">|</span><span>Reading time: 7 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><p><span id="understand"></span></p>
<h2 id="先大概了解浏览器加载历程下："><a href="#先大概了解浏览器加载历程下：" class="headerlink" title="先大概了解浏览器加载历程下："></a>先大概了解浏览器加载历程下：</h2><p><strong>首先，</strong>解析和构建完全不同概念，这点要清楚…<br><a id="more"></a><br><strong>其次，</strong>搞清楚顺序，只有先解析成浏览器能识别的字符串，才有DOM树的构建这一过程，因为构建的主语是浏览器。</p>
<p><strong>然后，</strong>浏览器在构造DOM树的同时，也在构造着另一棵树 CSS-Tree(其实是CSS规则的不一样的叫法)，与DOM树相对对应，所以暂且叫它-tree吧。</p>
<p><strong>最后，</strong>就是Render-Tree的形成，然后各种layout、paint，最后Display。</p>
<p><span id="top"></span></p>
<h2 id="跟着目录来："><a href="#跟着目录来：" class="headerlink" title="跟着目录来："></a>跟着目录来：</h2><ul>
<li><a href="#AssemblyLine">渲染流水线</a></li>
<li><a href="#understand">先大概了解下</a></li>
<li><a href="#lodingPrinciple">浏览器渲染机制</a><ul>
<li><a href="#whatDomTree">DOM-Tree 是什么?</a></li>
<li><a href="#DomTreeParse">DOM-Tree 结构 - 解析</a></li>
<li><a href="#DomTreeStructure">DOM-Tree 结构 - 构建</a></li>
<li><a href="#WhatCssTree">CSS-tree</a></li>
<li><a href="#WhatRenderTree">我们页面看到的到底是什么树?</a></li>
<li><a href="#css-selector">解析CSS-选择器的顺序</a></li>
</ul>
</li>
<li><a href="#optimization">性能优化注意点</a><ul>
<li><a href="#stopDom">会阻塞DOM树的构建的因素</a></li>
<li><a href="#stopReflowRepaint">会导致reflow、repaint的因素</a></li>
</ul>
</li>
<li><a href="#summary">总结</a></li>
</ul>
<p><span id="AssemblyLine"></span></p>
<h3 id="渲染流水线："><a href="#渲染流水线：" class="headerlink" title="渲染流水线："></a>渲染流水线：</h3><p><strong>大体上看</strong>：发送请求HTML文档–&gt;等待HTML文档响应–&gt;接收HTML文档的字符流响应–&gt;渲染页面。</p>
<p><span id="lodingPrinciple"></span></p>
<h3 id="浏览器渲染机制-图："><a href="#浏览器渲染机制-图：" class="headerlink" title="浏览器渲染机制 - 图："></a>浏览器渲染机制 - 图：</h3><p><strong>细节结合图来看，可能更容易理解：</strong><br><img src="https://wangten.com/public/blogImg/BrowerLodingDeep/browerLoding.png" alt="enter image description here"></p>
<h4 id="细节流程："><a href="#细节流程：" class="headerlink" title="细节流程："></a><strong>细节流程</strong>：</h4><ol>
<li>发送HTML文档请求—&gt;&gt;接收HTML文档字符流响应；</li>
<li>HTML的解析—&gt;&gt;开始DOM树结构的构建；</li>
<li>解析你的css脚本，于是寻找匹配并进行CSS-Rule的解析，即开始解析你写的CSS代码里的选择器，然后构建成 Style-Rules。</li>
<li><strong>注意，注意，2和3是同时进行的。</strong><br><strong>提示，如果你在初始化代码中，写了js操作dom代码，那么，这里只是能做到 解析js代码，看清楚，只是解析，相当于只是下载下来了，但不会去执行。因为css加载时是会阻塞js代码的运行的，其实就是阻塞了DOM的渲染。</strong></li>
<li>好，DOM树和CSS树已经构建完成了…</li>
<li><strong>再次注意，再次注意，这时候开始构建 Render-Tree了…</strong></li>
<li>其实过程是一个个地遍历 DOM树上的 节点，然后再去匹配已经初始化好的 CSS 样式规则，然后符合规则的就 Attachment(翻译过来是连接，其实是css-rule附着到DOM节点上，firefox上叫frame) 成一个Render对象，然后挂到Render树上。</li>
<li>当一个个Render对象挂上后，就结束Rerder树的构建之旅了，就开始各种计算了；</li>
<li>开始layout（布局，即位置，大小等），然后paint（渲染，即字体，背景等）；</li>
<li>还有，主要有一个Render对象被挂到Render树上，就有了Display属性了，就是show，就渲染在页面了 ，所以才会有你看到的页面是一点一点出来的，等所有对象挂上去Render树上了，才完成 Render 树的构建。</li>
</ol>
<p><a href="#top">给我回去</a></p>
<hr>
<p><span id="whatDomTree"></span></p>
<h4 id="DOM-Tree-是什么"><a href="#DOM-Tree-是什么" class="headerlink" title="DOM-Tree 是什么?"></a><strong>DOM-Tree 是什么?</strong></h4><p>可以理解为你页面上所有的<strong>元素标签</strong>他们的节点，共同构建成一颗树，而这棵树就是所谓的DOM树。</p>
<p><a href="#top">给我回去</a></p>
<p><span id="DomTreeParse"></span></p>
<h4 id="DOM-Tree-结构-解析："><a href="#DOM-Tree-结构-解析：" class="headerlink" title="DOM-Tree 结构 - 解析："></a><strong>DOM-Tree 结构 - 解析：</strong></h4><p>就是将从服务器返回的html文档上的字符流，浏览器使用解析HTML的引擎，通过词法分析、语法分析，将字符流解析成类似head、div等能被浏览器识别并渲染的标签。<br>通过词法解析和语法解析从网络请求得到的字符流，然后处理成浏览器能识别的字符串。</p>
<ul>
<li>词法解析：即通过一系列类似正则的关键词，术语叫token，用来匹配我们的标签；</li>
<li>语法解析：开始结束标签的配对、属性的赋值、父子关系的连接，最后构成dom树。</li>
</ul>
<p><a href="#top">给我回去</a></p>
<p><span id="DomTreeStructure"></span></p>
<h4 id="DOM-Tree-结构的-构建："><a href="#DOM-Tree-结构的-构建：" class="headerlink" title="DOM-Tree 结构的 - 构建："></a><strong>DOM-Tree 结构的 - 构建：</strong></h4><p>其实可以这么简单理解，DOM树就是各个标签的node节点堆积而成的一堆你看不懂，而浏览器能看懂的代码，并呈现给你看到的那样。</p>
<p>说是这么说简单，但还是要细化出来的。</p>
<p>通过解析成元素标签后，每个元素底层都是一个个的node节点，然后把这些节点一个个挂到一颗树上，这里还包括了Display为none的元素的节点，那么这棵树就是所谓的<strong>DOM-结构树</strong>了，而形成这棵树的过程就是构建DOM树了。</p>
<p><a href="#top">给我回去</a></p>
<p><span id="WhatCssTree"></span></p>
<h4 id="那这个CSS-tree是什么呢？"><a href="#那这个CSS-tree是什么呢？" class="headerlink" title="那这个CSS-tree是什么呢？"></a><strong>那这个CSS-tree是什么呢？</strong></h4><p>其实就是你写的各种CSS选择器以及css代码，形成的一个个规则对象。</p>
<h4 id="为什么会有CSS-tree？"><a href="#为什么会有CSS-tree？" class="headerlink" title="为什么会有CSS-tree？"></a><strong>为什么会有CSS-tree？</strong></h4><p>废话，肯定是匹配到Link或者style标签啊。<br>然后就是解析里面的CSS代码，解析成css引擎能识别的格式。<br>好，接下来就是<strong>解析</strong>了。<br>那浏览器怎么知道你这个css代码是要渲染页面的哪个位置呢？<br>CSS-选择器发挥作用的时候到了…<br>匹配的顺序是<strong>从右往左</strong>，这里一笔带过。<a href="#css-selector">点我去看看CSS-选择器匹配顺序</a></p>
<p><a href="#top">给我回去</a></p>
<h4 id="CSS-tree的构建："><a href="#CSS-tree的构建：" class="headerlink" title="CSS-tree的构建："></a><strong>CSS-tree的构建：</strong></h4><p>就是 CSS 选择器的匹配和代码的填充，填充到一个个的css-os里，然后挂到一颗叫Render的树上了。<br>然后就是什么Layout啊，paint了。</p>
<p><a href="#top">给我回去</a></p>
<p><span id="WhatRenderTree"></span></p>
<blockquote>
<p>Render-Tree - 示例图，废话和图更配哦~</p>
</blockquote>
<p><img src="https://wangten.com/public/blogImg/BrowerLodingDeep/RenderTreeDeep.png" alt="Render-Tree-Deep"></p>
<h4 id="Render树又是啥？"><a href="#Render树又是啥？" class="headerlink" title="Render树又是啥？"></a><strong>Render树又是啥？</strong></h4><p>我们页面看到的到底是什么树?<br>你首先要先知道Render-tree和DOM-tree以及CSS-tree之间的关系，可以这么看他们关系：<strong>Render-tree = Attachment =  Dom-tree + Style-Rules</strong>。<br>什么意思？</p>
<p>其实Render树就是我们页面看到的效果了，渲染树，是通过DOM树和CSS树连接而成的一棵树。上面挂了一个个 Html-Dom以及附着在 HTML-Dom上的Css-Dom。</p>
<p>其中，Render树每个节点都是一个对象，该对象结构上呈现<strong>矩形</strong>形状，其实这个就是控制台看到的盒子模型。</p>
<p><strong>注意，</strong>我把上面这句话的看到给特别加粗了。<br>其实是说display为none的元素，这时候设置了该css样式的元素节点是不会被挂到Render树上的，所以你在页面就看不到了。</p>
<p>所以，Render-Tree 就是用来展示效果的。</p>
<p><a href="#top">给我回去</a></p>
<p><span id="css-selector"></span></p>
<h4 id="解析CSS-选择器的顺序："><a href="#解析CSS-选择器的顺序：" class="headerlink" title="解析CSS-选择器的顺序："></a>解析CSS-选择器的顺序：</h4><p>还是一笔带过，<strong>从右往左</strong>。<br>太简单？惊不惊喜？意不意外？下面更惊喜！</p>
<p><strong>首先</strong>，先不说为什么，先说怎么知道的。<br>其实这是不成文的规定，是通过网络社区测试来的，至少我是不知道官方有这么说的，如果你知道，麻烦告知我。</p>
<p><strong>接下来说说为什么？</strong><br><strong>上面提到了</strong>，Render树的构建，其实是遍历DOM节点然后挂到Render树的，那既然是遍历，那就要循环了，如果循环的判断条件不好，那就很浪费资源，导致算法算得慢，浏览器自然也慢了。</p>
<p>假设下，如果<strong>从左往右</strong>，第一个匹配到的肯定是父元素。但父元素可以有很多个啊。而且，即使是匹配对了左边的父元素，但匹配到最后，有可能不是目标元素，而很可能是兄弟元素，然后又要重头来匹配，浪费了时间和资源以及性能。<br>这样不就<strong>折腾</strong>了吗？</p>
<p>那这时候，<strong>从右到左</strong>的渲染规则，就起到作用了。</p>
<p><strong>所以</strong>，一般，最右边的，一定就是被匹配的元素的class或者id等选择器了。<br>如果开始匹配到最右边的，有可能是目标元素，因为可能同名元素；<br>但是，如果连父元素都相同，那就没错了，就是你了。</p>
<p>这不，省了<strong>从左往右</strong>匹配的很大功夫了。</p>
<p>因此，很多浏览器也开始遵循这样的规则去构建Render树了。</p>
<p><a href="#top">给我回去</a></p>
<p><span id="optimization"></span></p>
<h3 id="性能优化注意点："><a href="#性能优化注意点：" class="headerlink" title="性能优化注意点："></a>性能优化注意点：</h3><p><span id="stopDom"></span></p>
<h4 id="会阻塞DOM树的构建的因素："><a href="#会阻塞DOM树的构建的因素：" class="headerlink" title="会阻塞DOM树的构建的因素："></a>会阻塞DOM树的构建的因素：</h4><ul>
<li>请求HTML字符流的网络被阻塞了。</li>
<li>构建DOM过程，遇到脚本的下载或加载，如script。</li>
<li>CSS样式文件的加载；</li>
</ul>
<p><a href="#top">给我回去</a></p>
<p><span id="stopReflowRepaint"></span></p>
<h4 id="会导致reflow、repaint的因素："><a href="#会导致reflow、repaint的因素：" class="headerlink" title="会导致reflow、repaint的因素："></a>会导致reflow、repaint的因素：</h4><ul>
<li>操作DOM，这个毋庸置疑了。</li>
<li>改变元素的大小和位置。</li>
<li>改变元素的样式，如颜色。</li>
</ul>
<p><a href="#top">给我回去</a></p>
<p><span id="summary"></span></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>照着js的<strong>万物接对象</strong>的理念下，把<strong>浏览器渲染一个网页的过程</strong>想象成一个大对象。<br>而构建这个对象的结构，就相当于是初始化网页。<br>会经过这样一个过程：<br>构建DOM树，CSS-Style，合成Render树，然后计算Render树上的属性，即layout，paint，最后添加Display。</p>
<p>一个文档（网页）就这么构建完成了。</p>
<p><img src="https://wangten.com/public/blogImg/BrowerLodingDeep/browerS.jpg" alt="browerS"></p>
<hr>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">JawQ_</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://wujiaqiang.com/2017/12/22/browerLoading/">http://wujiaqiang.com/2017/12/22/browerLoading/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://wangten.com/public/alipay.jpg"><div class="post-qr-code__desc">支付宝-打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="https://wangten.com/public/wechat.jpg"><div class="post-qr-code__desc">微信-打赏</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/01/06/specification/"><i class="fa fa-chevron-left">  </i><span>简析-CommonJS&amp;AMD&amp;CMD</span></a></div><div class="next-post pull-right"><a href="/2017/11/09/JSONP/"><span>吹吹 JSONP</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2015 - 2018 By JawQ_</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.4.3"></script><script src="/js/fancybox.js?version=1.4.3"></script><script src="/js/sidebar.js?version=1.4.3"></script><script src="/js/copy.js?version=1.4.3"></script><script src="/js/fireworks.js?version=1.4.3"></script><script src="/js/transition.js?version=1.4.3"></script><script src="/js/scroll.js?version=1.4.3"></script><script src="/js/head.js?version=1.4.3"></script></body></html>